<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>守株待兔 - Chengyu VR Completo</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Escena A-Frame con experiencia completamente visual -->
    <a-scene 
        id="scene" 
        style="height: 100vh; width: 100vw;"
        vr-mode-ui="enabled: true"
        device-orientation-permission-ui="enabled: false"
        stats="false"
        renderer="antialias: true; colorManagement: true; sortObjects: true; physicallyCorrectLights: true"
        background="color: #87CEEB">
        
        <!-- Assets optimizados -->
        <a-assets>
            <!-- Sin archivos de audio para evitar problemas -->
        </a-assets>

        <!-- Iluminación optimizada -->
        <a-light type="ambient" color="#404040" intensity="0.6"></a-light>
        <a-light type="directional" position="3 5 2" color="#ffffff" intensity="0.8" 
                 shadow="cast: true; mapSize: 2048"></a-light>
        
        <!-- Entorno base -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="25" height="25" 
                 color="#8FBC8F" shadow="receive: true"></a-plane>
        
        <!-- Montañas de fondo estabilizadas -->
        <a-triangle position="-10 2.5 -12" scale="4 4 1" color="#556B2F"></a-triangle>
        <a-triangle position="8 2 -10" scale="3 3 1" color="#6B8E23"></a-triangle>
        <a-triangle position="0 2.2 -15" scale="5 5 1" color="#808000"></a-triangle>

        <!-- Campo de cultivo -->
        <a-entity id="farm-field">
            <a-box position="-6 0.1 -2" width="8" height="0.3" depth="5" color="#8B4513" shadow="cast: true"></a-box>
            <a-box position="-7 0.12 -1" width="0.4" height="0.08" depth="4" color="#654321"></a-box>
            <a-box position="-6 0.12 -1" width="0.4" height="0.08" depth="4" color="#654321"></a-box>
            <a-box position="-5 0.12 -1" width="0.4" height="0.08" depth="4" color="#654321"></a-box>
            <a-box position="-4 0.12 -1" width="0.4" height="0.08" depth="4" color="#654321"></a-box>
        </a-entity>

        <!-- Maleza (inicialmente oculta) -->
        <a-entity id="weeds" visible="false">
            <a-cone position="-7 0.4 -1" radius-bottom="0.12" height="0.5" color="#228B22"></a-cone>
            <a-cone position="-6.5 0.35 -0.5" radius-bottom="0.1" height="0.4" color="#32CD32"></a-cone>
            <a-cone position="-5.5 0.45 -1.8" radius-bottom="0.15" height="0.6" color="#228B22"></a-cone>
            <a-cone position="-4.5 0.4 -0.8" radius-bottom="0.11" height="0.5" color="#32CD32"></a-cone>
            <a-cone position="-6 0.38 -2.5" radius-bottom="0.13" height="0.45" color="#228B22"></a-cone>
        </a-entity>

        <!-- Tocón del árbol (elemento central estabilizado) -->
        <a-entity id="tree-stump" position="3 0 -4" stable-object>
            <a-cylinder position="0 0.6 0" radius="0.9" height="1.2" color="#8B4513" shadow="cast: true"></a-cylinder>
            <a-ring position="0 1.21 0" radius-inner="0.12" radius-outer="0.8" color="#654321" rotation="-90 0 0"></a-ring>
            <a-ring position="0 1.21 0" radius-inner="0.35" radius-outer="0.6" color="#8B4513" rotation="-90 0 0"></a-ring>
            <a-box position="0.7 0.4 0" width="0.12" height="0.5" depth="0.12" color="#654321"></a-box>
            <a-box position="-0.6 0.8 0.4" width="0.12" height="0.4" depth="0.12" color="#654321"></a-box>
        </a-entity>

        <!-- Granjero con animaciones estabilizadas -->
        <a-entity id="farmer" position="-6 0 -1" story-character stable-object>
            <a-cylinder position="0 1.3 0" radius="0.35" height="0.9" color="#8B4513" shadow="cast: true"></a-cylinder>
            <a-sphere position="0 1.9 0" radius="0.28" color="#D2B48C"></a-sphere>
            <a-cone position="0 2.25 0" radius-bottom="0.45" radius-top="0.12" height="0.35" color="#8B4513"></a-cone>
            <a-sphere position="-0.45 1.5 0" radius="0.12" color="#D2B48C"></a-sphere>
            <a-cylinder position="-0.7 1.2 0" radius="0.1" height="0.45" color="#D2B48C" rotation="0 0 -25"></a-cylinder>
            <a-sphere position="0.45 1.5 0" radius="0.12" color="#D2B48C"></a-sphere>
            <a-cylinder position="0.7 1.2 0" radius="0.1" height="0.45" color="#D2B48C" rotation="0 0 25"></a-cylinder>
            <a-cylinder position="-0.18 0.45 0" radius="0.12" height="0.9" color="#654321"></a-cylinder>
            <a-cylinder position="0.18 0.45 0" radius="0.12" height="0.9" color="#654321"></a-cylinder>
            <a-cylinder id="farming-tool" position="0.9 1.3 0" radius="0.06" height="1.7" color="#8B4513" rotation="0 0 40"></a-cylinder>
        </a-entity>

        <!-- Conejo con movimiento suave -->
        <a-entity id="rabbit" position="12 0.25 -4" rabbit-controller stable-object>
            <a-sphere position="0 0.35 0" radius="0.35" color="#FFFFFF" scale="1.3 0.9 1.1" shadow="cast: true"></a-sphere>
            <a-sphere position="0.35 0.45 0" radius="0.23" color="#FFFFFF"></a-sphere>
            <a-sphere position="0.45 0.75 -0.12" radius="0.09" color="#FFFFFF" scale="0.6 2.2 0.6"></a-sphere>
            <a-sphere position="0.45 0.75 0.12" radius="0.09" color="#FFFFFF" scale="0.6 2.2 0.6"></a-sphere>
            <a-sphere position="0.45 0.68 -0.12" radius="0.035" color="#FFB6C1" scale="0.6 1.8 0.6"></a-sphere>
            <a-sphere position="0.45 0.68 0.12" radius="0.035" color="#FFB6C1" scale="0.6 1.8 0.6"></a-sphere>
            <a-sphere position="0.52 0.5 -0.1" radius="0.035" color="#000000"></a-sphere>
            <a-sphere position="0.52 0.5 0.1" radius="0.035" color="#000000"></a-sphere>
            <a-sphere position="0.58 0.45 0" radius="0.025" color="#FFB6C1"></a-sphere>
            <a-sphere position="0.12 0.12 -0.18" radius="0.09" color="#FFFFFF"></a-sphere>
            <a-sphere position="0.12 0.12 0.18" radius="0.09" color="#FFFFFF"></a-sphere>
            <a-sphere position="-0.12 0.12 -0.18" radius="0.09" color="#FFFFFF"></a-sphere>
            <a-sphere position="-0.12 0.12 0.18" radius="0.09" color="#FFFFFF"></a-sphere>
            <a-sphere position="-0.35 0.4 0" radius="0.12" color="#FFFFFF" scale="0.7 0.7 0.7"></a-sphere>
        </a-entity>

        <!-- Conejo muerto (inicialmente oculto) -->
        <a-entity id="dead-rabbit" position="3.5 0.05 -4" visible="false" stable-object>
            <a-sphere position="0 0.12 0" radius="0.35" color="#F5F5F5" scale="1.3 0.9 1.1" rotation="0 0 85"></a-sphere>
            <a-sphere position="0.35 0.18 0" radius="0.23" color="#F5F5F5" rotation="0 0 40"></a-sphere>
            <a-sphere position="0.6 0.25 -0.12" radius="0.09" color="#F5F5F5" scale="0.6 2.2 0.6" rotation="40 0 0"></a-sphere>
            <a-sphere position="0.6 0.25 0.12" radius="0.09" color="#F5F5F5" scale="0.6 2.2 0.6" rotation="40 0 0"></a-sphere>
        </a-entity>

        <!-- Efectos visuales estabilizados -->
        <a-entity id="dust-particles" position="3 0.6 -4" visible="false" stable-object>
            <a-sphere radius="0.025" color="#D2B48C" opacity="0.7"></a-sphere>
            <a-sphere radius="0.018" color="#DEB887" opacity="0.6" position="0.12 0.12 0.12"></a-sphere>
            <a-sphere radius="0.025" color="#F4A460" opacity="0.5" position="-0.12 0.06 -0.12"></a-sphere>
            <a-sphere radius="0.015" color="#D2B48C" opacity="0.7" position="0.06 -0.06 0.18"></a-sphere>
        </a-entity>

        <!-- Modal Popup 3D Integrado -->
        <a-entity id="modal-3d" position="0 2.5 -3" visible="false" story-popup>
            <!-- Fondo del modal -->
            <a-plane id="modal-background" position="0 0 -0.1" width="8" height="5" 
                     color="#000000" opacity="0.8" 
                     material="transparent: true"></a-plane>
            
            <!-- Panel de contenido -->
            <a-plane id="modal-panel" position="0 0 0" width="7" height="4.5" 
                     color="#FFFFFF" 
                     material="side: double">
                
                <!-- Título principal -->
                <a-text value="守株待兔" position="0 1.6 0.01" align="center" 
                        color="#C41E3A" width="12" font="roboto"
                        geometry="primitive: plane; width: auto; height: auto"
                        material="color: transparent"></a-text>
                
                <!-- Subtítulo -->
                <a-text value="Shǒu Zhū Dài Tù" position="0 1.1 0.01" align="center" 
                        color="#666666" width="8"
                        geometry="primitive: plane; width: auto; height: auto"
                        material="color: transparent"></a-text>
                
                <!-- Línea separadora -->
                <a-plane position="0 0.7 0.01" width="6" height="0.05" color="#C41E3A"></a-plane>
                
                <!-- Texto explicativo -->
                <a-text value="Este chengyu proviene del Huainanzi (淮南子),&#10;un texto taoísta del siglo II a.C.&#10;&#10;La historia enseña sobre los peligros de&#10;depender de la suerte en lugar del trabajo&#10;duro y la planificación constante." 
                        position="0 0.1 0.01" align="center" 
                        color="#2C2C2C" width="6"
                        geometry="primitive: plane; width: auto; height: auto"
                        material="color: transparent"></a-text>
                
                <!-- Panel de moraleja -->
                <a-plane position="0 -1.3 0.01" width="6.5" height="1" color="#667eea"
                         material="side: double">
                    <a-text value="Moraleja:&#10;No confíes en golpes de suerte;&#10;el éxito viene del esfuerzo constante." 
                            position="0 0 0.01" align="center" 
                            color="white" width="5"
                            geometry="primitive: plane; width: auto; height: auto"
                            material="color: transparent"></a-text>
                </a-plane>
                
                <!-- Botón de cerrar -->
                <a-cylinder id="close-button" position="3.2 1.8 0.02" radius="0.2" height="0.05" 
                           color="#ff4444" 
                           cursor-listener="clickSound: false"
                           animation__hover="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                           animation__unhover="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
                    <a-text value="✕" position="0 0 0.01" align="center" color="white" width="8"></a-text>
                </a-cylinder>
            </a-plane>
        </a-entity>

        <!-- Controles 3D integrados -->
        <a-entity id="controls-3d" position="0 0.8 -6" visible="true">
            <!-- Botón reiniciar -->
            <a-cylinder id="restart-3d-btn" position="-2 0 0" radius="0.4" height="0.15" 
                       color="#C41E3A" 
                       cursor-listener="clickSound: false"
                       animation__hover="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                       animation__unhover="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
                <a-text value="Reiniciar" position="0 0 0.08" align="center" color="white" width="6"></a-text>
            </a-cylinder>
            
            <!-- Botón cambiar vista -->
            <a-cylinder id="camera-3d-btn" position="0 0 0" radius="0.4" height="0.15" 
                       color="#2E8B57" 
                       cursor-listener="clickSound: false"
                       animation__hover="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                       animation__unhover="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
                <a-text value="Vista" position="0 0 0.08" align="center" color="white" width="6"></a-text>
            </a-cylinder>
            
            <!-- Botón info -->
            <a-cylinder id="info-3d-btn" position="2 0 0" radius="0.4" height="0.15" 
                       color="#FF6B35" 
                       cursor-listener="clickSound: false"
                       animation__hover="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                       animation__unhover="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
                <a-text value="Info" position="0 0 0.08" align="center" color="white" width="6"></a-text>
            </a-cylinder>
        </a-entity>

        <!-- Indicador de progreso 3D -->
        <a-entity id="progress-3d" position="0 0.3 -5.5" visible="true">
            <a-plane position="0 0 0" width="6" height="0.3" color="#333333"></a-plane>
            <a-plane id="progress-fill-3d" position="-2.85 0 0.01" width="0.3" height="0.25" color="#C41E3A"></a-plane>
            
            <!-- Etiquetas de escena -->
            <a-text value="Trabajo" position="-2.5 -0.3 0" align="center" color="white" width="4"></a-text>
            <a-text value="Suerte" position="-0.8 -0.3 0" align="center" color="white" width="4"></a-text>
            <a-text value="Espera" position="0.8 -0.3 0" align="center" color="white" width="4"></a-text>
            <a-text value="Ruina" position="2.5 -0.3 0" align="center" color="white" width="4"></a-text>
        </a-entity>

        <!-- Sistema de cámara estabilizado con rig -->
        <a-entity id="camera-rig" 
                  position="0 0 6"
                  movement-controls="fly: false; constrainToNavMesh: false"
                  stable-camera-rig>
            <a-camera id="main-camera" 
                      position="0 1.7 0"
                      camera="userHeight: 1.7; fov: 75; near: 0.1; far: 1000"
                      look-controls="enabled: true; magicWindowTrackingEnabled: true; pointerLockEnabled: false; touchEnabled: true; mouseEnabled: true"
                      wasd-controls="enabled: true; acceleration: 65; fly: false"
                      cursor="rayOrigin: mouse; fuse: true; fuseTimeout: 1500"
                      raycaster="objects: [cursor-listener]">
                
                <!-- Reticle para VR -->
                <a-ring position="0 0 -0.5" radius-inner="0.01" radius-outer="0.02" 
                        color="white" opacity="0.8"></a-ring>
            </a-camera>
        </a-entity>
    </a-scene>

    <script src="app.js"></script>
</body>
</html>

